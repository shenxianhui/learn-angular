{"version":3,"file":"rule-expression.js.map","sources":["ng://rule-expression/lib/rule-expression.component.ts","ng://rule-expression/lib/rule-expression.module.ts","ng://rule-expression/public-api.ts"],"sourcesContent":["import { Component, OnInit } from \"@angular/core\";\nimport { PluginManagerService, componentData } from \"plugin-manager\";\nimport { NzMessageService } from \"ng-zorro-antd\";\n\ninterface NgModelItem {\n  select1Val?: string;\n  select2Val?: string;\n  inputVal?: string;\n}\n\n@Component({\n  selector: \"lib-rule-expression\",\n  templateUrl: \"./rule-expression.component.html\",\n  styleUrls: [\"./rule-expression.component.styl\"],\n})\nexport class RuleExpressionComponent implements OnInit {\n  configData: any = {};\n  ngModel: NgModelItem[] = [{}];\n  symbolList = [\n    {\n      label: \"=\",\n      value: \"=\",\n    },\n    {\n      label: \"!=\",\n      value: \"!=\",\n    },\n    {\n      label: \"in\",\n      value: \"in\",\n    },\n    {\n      label: \"not in\",\n      value: \"not in\",\n    },\n  ];\n\n  data: any;\n  color: any;\n  containerOperate: any;\n\n  constructor(\n    private pluginManagerService: PluginManagerService,\n    private message: NzMessageService,\n    comData: componentData\n  ) {\n    // æ¥æ¶ä¸­é´ä»¶ä¼ å¼\n    console.log(\"comData\", comData);\n    this.data = comData.configData.data;\n    this.color = comData.configData.color;\n    this.configData = comData.configData;\n  }\n\n  ngOnInit() {\n    if (this.configData && this.configData.emitFun) {\n      const { containerOperate } = this.configData.emitFun();\n      this.containerOperate = containerOperate().callBack((res) => {\n        this.checkedForm()\n          .then(() => {\n            console.log(this.ngModel);\n          })\n          .catch((err = {}) => {\n            const { row, name, message } = err;\n\n            // this.message.create(\n            //   \"error\",\n            //   `[ç¬¬${row + 1}è¡-${name}]: ${message}`\n            // );\n          });\n      }, this.configData[\"showId\"]);\n    }\n  }\n\n  // æ´é²æäº¤æ¹æ³\n  public onSubmitForm() {\n    return new Promise((resolve, reject) => {\n      this.checkedForm()\n        .then((res) => {\n          resolve(this.ngModel);\n        })\n        .catch((err = {}) => {\n          const { row, name, message } = err;\n\n          this.message.create(\"error\", `[ç¬¬${row + 1}è¡-${name}]: ${message}`);\n          reject(err);\n        });\n    });\n  }\n\n  // æ°å¼æ¹åæ¶åè°\n  ngModelChange(type, itm, idx) {\n    console.log(type, itm, idx);\n    this.containerOperate &&\n      this.containerOperate\n        .UpdateData({\n          showId: this.configData[\"showId\"] ? this.configData[\"showId\"] : null,\n          control_value: this.ngModel,\n          control_key: this.configData[\"data\"].control_key,\n        })\n        .FormVerification({\n          showId: this.configData[\"showId\"] ? this.configData[\"showId\"] : null,\n          formRegList: [this.configData[\"data\"].control_key],\n        });\n  }\n\n  // å¤´é¨å³ä¾§æé®\n  handleHeaderBtn(itm) {\n    if (itm.value === \"add\") {\n      if (this.ngModel.length >= 3) {\n        this.message.create(\"warning\", `æå¤§æ°éä¸è½è¶è¿${3}`);\n        return;\n      }\n      this.ngModel.push({});\n    }\n    if (itm.value === \"clear\") {\n      //\n    }\n  }\n\n  // è¡-å é¤\n  handleDel(itm, idx) {\n    this.ngModel.splice(idx, 1);\n  }\n\n  // å°¾é¨æé®\n  handleBottomBtn(itm) {\n    if (itm.value === \"search\") {\n      this.checkedForm()\n        .then((res) => {\n          console.log(JSON.stringify(this.ngModel));\n          alert(JSON.stringify(this.ngModel));\n        })\n        .catch((err = {}) => {\n          const { row, name, message } = err;\n\n          this.message.create(\"error\", `[ç¬¬${row + 1}è¡-${name}]: ${message}`);\n        });\n    }\n  }\n\n  // æ ¡éª\n  checkedForm() {\n    return new Promise((resolve, reject) => {\n      const validationRule = this.data.validationRule || [];\n\n      if (validationRule.length) {\n        const checkedSelect1 = validationRule.find(\n          (item) => item.name === \"select1\"\n        );\n        const checkedSelect2 = validationRule.find(\n          (item) => item.name === \"select2\"\n        );\n        const checkedInput = validationRule.find(\n          (item) => item.name === \"input\"\n        );\n        let res = {\n          row: -1,\n          name: \"\",\n          message: \"\",\n        };\n\n        for (let i = 0; i < this.ngModel.length; i++) {\n          const item = this.ngModel[i] || {};\n\n          if (checkedSelect1 && !item.select1Val) {\n            res = {\n              row: i,\n              ...checkedSelect1,\n            };\n            break;\n          }\n          if (checkedSelect2 && !item.select2Val) {\n            res = {\n              row: i,\n              ...checkedSelect2,\n            };\n            break;\n          }\n          if (checkedInput && !item.inputVal) {\n            res = {\n              row: i,\n              ...checkedInput,\n            };\n            break;\n          }\n        }\n\n        if (res.row > -1) {\n          reject(res);\n        } else {\n          resolve(true);\n        }\n      } else {\n        resolve(true);\n      }\n    });\n  }\n}\n","import { NgModule } from \"@angular/core\";\nimport { RuleExpressionComponent } from \"./rule-expression.component\";\nimport { NgZorroAntdModule } from \"ng-zorro-antd\";\nimport { CommonModule } from \"@angular/common\";\nimport { FormsModule } from \"@angular/forms\";\n\n@NgModule({\n  declarations: [RuleExpressionComponent],\n  entryComponents: [RuleExpressionComponent],\n  imports: [CommonModule, NgZorroAntdModule, FormsModule],\n  exports: [RuleExpressionComponent],\n})\nexport class RuleExpressionModule {}\n","import { createPlugin } from \"plugin-manager\";\nimport { RuleExpressionComponent } from \"./lib/rule-expression.component\";\nimport { RuleExpressionModule } from \"./lib/rule-expression.module\";\n\nexport default createPlugin({\n  name: \"rule-expression\",\n  module: RuleExpressionModule,\n  component: RuleExpressionComponent,\n});\n"],"names":[],"mappings":"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"}
