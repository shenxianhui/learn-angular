!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("plugin-manager"),require("@angular/core"),require("ng-zorro-antd"),require("@angular/common"),require("@angular/forms")):"function"==typeof define&&define.amd?define("rule-expression",["plugin-manager","@angular/core","ng-zorro-antd","@angular/common","@angular/forms"],n):e["rule-expression"]=n(e.pluginManager,e.ng.core,e.ngZorroAntd,e.ng.common,e.ng.forms)}(this,function(e,n,t,o,i){"use strict";var u=function(){return(u=Object.assign||function u(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e}).apply(this,arguments)},l=(r.prototype.ngOnInit=function(){var e,n=this;this.configData&&this.configData.emitFun&&(e=this.configData.emitFun().containerOperate,this.containerOperate=e().callBack(function(e){n.checkedForm().then(function(){console.log(n.ngModel)})["catch"](function(e){(e=void 0===e?{}:e).row,e.name,e.message})},this.configData.showId))},r.prototype.onSubmitForm=function(){var l=this;return new Promise(function(n,i){l.checkedForm().then(function(e){n(l.ngModel)})["catch"](function(e){var n=(e=void 0===e?{}:e).row,t=e.name,o=e.message;l.message.create("error","[第"+(n+1)+"行-"+t+"]: "+o),i(e)})})},r.prototype.ngModelChange=function(e,n,t){console.log(e,n,t),this.containerOperate&&this.containerOperate.UpdateData({showId:this.configData.showId||null,control_value:this.ngModel,control_key:this.configData.data.control_key}).FormVerification({showId:this.configData.showId||null,formRegList:[this.configData.data.control_key]})},r.prototype.handleHeaderBtn=function(e){if("add"===e.value){if(3<=this.ngModel.length)return void this.message.create("warning","最大数量不能超过3");this.ngModel.push({})}e.value},r.prototype.handleDel=function(e,n){this.ngModel.splice(n,1)},r.prototype.handleBottomBtn=function(e){var o=this;"search"===e.value&&this.checkedForm().then(function(e){console.log(JSON.stringify(o.ngModel)),alert(JSON.stringify(o.ngModel))})["catch"](function(e){var n=(e=void 0===e?{}:e).row,t=e.name,e=e.message;o.message.create("error","[第"+(n+1)+"行-"+t+"]: "+e)})},r.prototype.checkedForm=function(){var c=this;return new Promise(function(e,n){var t=c.data.validationRule||[];if(t.length){for(var o=t.find(function(e){return"select1"===e.name}),i=t.find(function(e){return"select2"===e.name}),l=t.find(function(e){return"input"===e.name}),r={row:-1,name:"",message:""},a=0;a<c.ngModel.length;a++){var s=c.ngModel[a]||{};if(o&&!s.select1Val){r=u({row:a},o);break}if(i&&!s.select2Val){r=u({row:a},i);break}if(l&&!s.inputVal){r=u({row:a},l);break}}-1<r.row?n(r):e(!0)}else e(!0)})},r.decorators=[{type:n.Component,args:[{selector:"lib-rule-expression",template:'<div class="filter-rules">\n  <div class="filter-rules-header">\n    <nz-radio-group [(ngModel)]="data.searchType">\n      <label nz-radio-button nzValue="AND">AND</label>\n      <label nz-radio-button nzValue="OR">OR</label>\n    </nz-radio-group>\n    <div class="buttons">\n      \x3c!-- <button nz-button (click)="handleAdd()"><i nz-icon type="plus"></i>Rule</button> --\x3e\n      <button\n        class="ml10"\n        *ngFor="let item of data.executeInfo || []"\n        [nzType]="item.type"\n        nz-button\n        (click)="handleHeaderBtn(item)"\n      >\n        <i *ngIf="item.icon" nz-icon [type]="item.icon"></i>\n        {{ item.label }}\n      </button>\n    </div>\n  </div>\n  <div class="filter-rules-body">\n    <div *ngFor="let item of ngModel || []; let index = index" class="row">\n      <div class="row-l">\n        <div class="row-index">{{ index + 1 }}</div>\n        <nz-select\n          class="select select1 mr5"\n          [(ngModel)]="item.select1Val"\n          nzAllowClear\n          nzPlaceHolder="请选择"\n          (ngModelChange)="ngModelChange(\'select1\', item, index)"\n        >\n          <nz-option\n            *ngFor="let opt of data.option || []"\n            [nzValue]="opt.value"\n            [nzLabel]="opt.label"\n          ></nz-option>\n        </nz-select>\n        <nz-select\n          class="select select2 mr5"\n          [(ngModel)]="item.select2Val"\n          nzAllowClear\n          nzPlaceHolder="请选择"\n          (ngModelChange)="ngModelChange(\'select2\', item, index)"\n        >\n          <nz-option\n            *ngFor="let opt of symbolList || []"\n            [nzValue]="opt.value"\n            [nzLabel]="opt.label"\n          ></nz-option>\n        </nz-select>\n        <div class="input">\n          <nz-input-group [nzSuffix]="suffixTemplate">\n            <input\n              type="text"\n              nz-input\n              [(ngModel)]="item.inputVal"\n              (input)="ngModelChange(\'input\', item, index)"\n              placeholder="请输入"\n            />\n          </nz-input-group>\n          <ng-template #suffixTemplate>\n            <i\n              nz-icon\n              nz-tooltip\n              class="ant-input-clear-icon"\n              nzTheme="fill"\n              nzType="close-circle"\n              *ngIf="item.inputVal"\n              (click)="item.inputVal = \'\'"\n            ></i>\n          </ng-template>\n        </div>\n      </div>\n      <div class="row-r">\n        <button nz-button nzType="danger" (click)="handleDel(item, index)">\n          <i nz-icon type="close"></i>\n        </button>\n      </div>\n    </div>\n  </div>\n  \x3c!-- <div class="filter-rules-footer">\n    <button\n      class="ml10"\n      *ngFor="let item of data.internalApi || []"\n      [nzType]="item.type"\n      nz-button\n      nzType="primary"\n      (click)="handleBottomBtn(item)"\n    >\n      {{ item.label }}\n    </button>\n  </div> --\x3e\n</div>\n',styles:[".mr5{margin-right:5px}.mr10{margin-right:10px}.ml5{margin-left:5px}.ml10{margin-left:10px}.filter-rules{padding:10px;background:#fff}.filter-rules .filter-rules-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}.filter-rules .filter-rules-body .row{display:flex;align-items:center;justify-content:space-between;margin-bottom:5px;border:1px solid #ccc;border-radius:4px;padding:5px}.filter-rules .filter-rules-body .row .row-l{display:flex;align-items:center;justify-content:space-between}.filter-rules .filter-rules-body .row .row-l .row-index{padding:0 20px}.filter-rules .filter-rules-body .row .row-l .select{flex-shrink:0;width:150px}.filter-rules .filter-rules-body .row .row-l .select.select2{width:80px}.filter-rules .filter-rules-body .row .row-l .input{width:250px}.filter-rules .filter-rules-footer{margin-top:10px;display:flex;align-items:center;justify-content:flex-end}"]}]}],r.ctorParameters=function(){return[{type:e.PluginManagerService},{type:t.NzMessageService},{type:e.componentData}]},r);function r(e,n,t){this.pluginManagerService=e,this.message=n,this.configData={},this.ngModel=[{}],this.symbolList=[{label:"=",value:"="},{label:"!=",value:"!="},{label:"in",value:"in"},{label:"not in",value:"not in"}],console.log("comData",t),this.data=t.configData.data,this.color=t.configData.color,this.configData=t.configData}function a(){}return a.decorators=[{type:n.NgModule,args:[{declarations:[l],entryComponents:[l],imports:[o.CommonModule,t.NgZorroAntdModule,i.FormsModule],exports:[l]}]}],e.createPlugin({name:"rule-expression",module:a,component:l})});
//# sourceMappingURL=rule-expression.umd.min.js.map