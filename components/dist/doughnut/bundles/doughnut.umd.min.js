!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("plugin-manager"),require("ng-zorro-antd"),require("@angular/common"),require("@angular/core")):"function"==typeof define&&define.amd?define("doughnut",["plugin-manager","ng-zorro-antd","@angular/common","@angular/core"],e):t.doughnut=e(t.pluginManager,t.ngZorroAntd,t.ng.common,t.ng.core)}(this,function(t,e,i,a){"use strict";var o=window.$,n=(r.prototype.backEmit=function(t){t&&(this.chart=t)},r.prototype.onResize=function(){this.chart&&this.chart.resize()},r.prototype.ngOnInit=function(){this.fetchData(!1)},r.prototype.pageOperation=function(){var t,e=JSON.parse(JSON.stringify(this.doughnutData.pageInfo));this.pageLoading=!1,this.leftText=e.leftText,this.rightText=e.rightText,this.doughnutData.data.length>e.onePageShowNum?(e=(t=e.onePageShowNum*(this.btnShowIndex-1))+e.onePageShowNum,this.currentShowData=this.doughnutData.data.slice(t,e)):this.currentShowData=this.doughnutData.data},r.prototype.pageReset=function(){this.pageLoading=!0,this.leftActive=!0,this.rightActive=!1,this.leftText="",this.rightText="",this.btnShowIndex=1},r.prototype.pageBtn=function(t){"leftActive"===t?(this.btnShowIndex<=1?this.btnShowIndex=1:this.btnShowIndex=this.btnShowIndex-1,this.leftActive=!0,this.rightActive=!1):(this.btnShowIndex>=Math.ceil(this.doughnutData.data.length/this.doughnutData.pageInfo.onePageShowNum)?this.btnShowIndex=Math.ceil(this.doughnutData.data.length/this.doughnutData.pageInfo.onePageShowNum):this.btnShowIndex++,this.leftActive=!1,this.rightActive=!0),this.fetchData(this.moduleData[2])},r.prototype.switchOperation=function(){var i=this,t=(this.switchInfo=JSON.parse(JSON.stringify(this.doughnutData.switchInfo)),this.switchColor!==undefined&&0!==this.switchColor.length||(this.switchColor=["#55a722","#ff7e75","#0099ff","#d284d9","#ffbb29"]),this.switchInfo.forEach(function(t,e){t.switchColor=i.switchColor[e%i.switchColor.length]}),this.switchLoading=!1,this.switchInfo[this.switchAcitveIndex]);t||(this.switchAcitveIndex=0,t=this.switchInfo[0]),this.currentShowData=this.doughnutData.data.slice(t.rangeData[0],t.rangeData[1]+1)},r.prototype.switchReset=function(){this.switchLoading=!0,this.switchAcitveIndex=0,this.switchInfo=[{switchText:"基本环图1",rangeData:[0,3]},{switchText:"基本环图2",rangeData:[4,5]},{switchText:"基本环图3",rangeData:[6,9]},{switchText:"基本环图4",rangeData:[10,12]},{switchText:"基本环图5",rangeData:[3,9]},{switchText:"基本环图6",rangeData:[0,11]}],this.switchColor=[]},r.prototype.switchBtn=function(t){this.switchAcitveIndex=t,this.fetchData(this.moduleData[2])},r.prototype.fetchData=function(t){switch(this.configData.data&&this.configData.data.data instanceof Array&&(this.doughnutData=JSON.parse(JSON.stringify(this.configData.data))),this.configData.color&&(this.configData.color.switchColor instanceof Array&&(this.switchColor=(0!==this.configData.color.switchColor.length?this.configData.color:this).switchColor),this.configData.color.doughnutColor instanceof Array&&(this.doughnutColor=(0!==this.configData.color.doughnutColor.length?this.configData.color:this).doughnutColor),this.configData.color.legendWidth&&(this.legendWidth=this.configData.color.legendWidth),this.configData.color.legendTop)&&(this.legendTop=this.configData.color.legendTop),!0){case!!this.doughnutData.switchInfo:this.switchOperation();break;case!!this.doughnutData.pageInfo:this.switchReset(),this.pageOperation();break;default:this.switchReset(),this.pageReset(),this.currentShowData=this.doughnutData.data}this.donutChartData={theme:"dark",color:this.doughnutColor,legendX:"right",legendWidth:this.legendWidth,legendTop:this.legendTop,formatValue:"format",seriesData:this.currentShowData,title:{titleNum:this.doughnutData.title?this.doughnutData.title.titleNum:"",titleText:this.doughnutData.title?this.doughnutData.title.titleText:""},tooltip:{position:["30%","50%"]},radius:["60%","75%"],radius1:["50%","60%"]}},r.decorators=[{type:a.Component,args:[{selector:"lib-doughnut",template:'\x3c!-- 分页和切换配置项均存在时，默认展示切换模式 --\x3e\n<div class="switchArea" *ngIf="!switchLoading">\n    <div class="switchBox" *ngFor="let switchData of switchInfo; let i = index" (click)="switchBtn(i)">\n        <div class="switchColor" [ngStyle]="{background: i==switchAcitveIndex ? switchData.switchColor : \'#C9C9C9\'}">\n        </div>\n        <p class="switchText">{{switchData.switchText}}</p>\n    </div>\n</div> \n\n<div class="pageArea" *ngIf="switchLoading && !pageLoading">\n    <div class="pageBox" (click)="pageBtn(\'leftActive\')">\n        <div class="pageColor" [ngStyle]="{background: leftActive ? \'cornflowerblue\' : \'#C9C9C9\'}"></div>\n        <p class="pageText">{{leftText}}</p>  \n    </div>\n    <div class="pageBox" (click)="pageBtn(\'rightActive\')">\n        <div class="pageColor" [ngStyle]="{background: rightActive ? \'coral\' : \'#C9C9C9\'}"></div>\n        <p class="pageText">{{rightText }}</p>\n    </div>\n</div> \n\n<div [appEchartsFilterpieLegend]="donutChartData" [that]="that" [backEmit]="backEmit"\n    style="height:90%">\n</div>',styles:[".switchArea{width:50%;display:flex;flex-wrap:wrap;margin-left:54%;cursor:pointer}.switchArea .switchBox{margin-right:3%;display:flex}.switchArea .switchColor{width:14px;height:14px;color:#fff;margin:auto 0}.switchArea .switchText{margin:auto 0 auto 10px;color:#fff}.pageArea{width:42%;height:10%;display:flex;margin-left:54%;cursor:pointer}.pageArea .pageBox{width:50%;display:flex}.pageColor{width:14px;height:14px;color:#fff;margin:auto 0}.pageText{margin:auto 0 auto 10px;color:#fff}"]}]}],r.ctorParameters=function(){return[{type:a.ElementRef},{type:t.PluginManagerService},{type:t.componentData}]},r);function r(t,e,i){this.el=t,this.pluginManagerService=e,this.moduleData=[0,null,!1],this.doughnutData={},this.leftActive=!0,this.rightActive=!1,this.leftText="",this.rightText="",this.btnShowIndex=1,this.switchAcitveIndex=0,this.switchInfo=[{switchText:"基本环图1",rangeData:[0,3]},{switchText:"基本环图2",rangeData:[4,5]},{switchText:"基本环图3",rangeData:[6,9]},{switchText:"基本环图4",rangeData:[10,12]},{switchText:"基本环图5",rangeData:[3,9]},{switchText:"基本环图6",rangeData:[0,11]}],this.switchColor=["#55a722","#ff7e75","#0099ff","#d284d9","#ffbb29"],this.doughnutColor=["rgb(253,97,55)","rgb(248,193,71)","rgb(53,100,255)","rgb(35,170,241)","rgb(2,207,150)","#d284d9"],this.legendWidth=undefined,this.legendTop="10%",this.pageLoading=!0,this.switchLoading=!0,(this.that=this).$elem=o(this.el.nativeElement),this.configData=i.configData}var h=window.$,l=window.echarts;function s(t){this.el=t,this.resizeNamespace="resize."+Date.now(),this.$elem=h(t.nativeElement)}function c(){}return s.prototype.renderChart=function(){var t,a=this,e={tooltip:{trigger:"item",formatter:this.appEchartsFilterpieLegend.formatter||"{a} <br/>{b}: {c} ({d}%)",backgroundColor:"rgba(0, 0, 0, 0.7)",padding:[15,20,15,20],textStyle:{fontSize:"14"}},title:{zlevel:0,show:!0,text:this.appEchartsFilterpieLegend.title.titleNum,subtext:this.appEchartsFilterpieLegend.title.titleText,left:"25%",top:"38%",textAlign:"center",textStyle:{color:"#fff",fontSize:20,lineHeight:12,fontWeight:40,fontFamily:"PingFangHK, PingFangHK-Semibold"},subtextStyle:{color:"#fff",fontSize:12,lineHeight:12}},color:this.appEchartsFilterpieLegend.color,legend:{show:!0,orient:"vertical",x:"right",y:"bottom",align:"left",itemGap:12,icon:"rect",type:"scroll",top:this.appEchartsFilterpieLegend.legendTop||"top",left:"55%",itemHeight:8,itemWidth:8,formatter:null,textStyle:{color:"rgba(255,255,255,0.85)",fontSize:14,rich:{a:{fontSize:14,width:this.appEchartsFilterpieLegend.legendWidth||undefined},b:{fontSize:14,padding:[0,0,0,10]}}},tooltip:null,data:[]},grid:{top:20,right:30,bottom:20,left:"auto"},series:[{name:"v",type:"pie",selectedMode:"single",selectedOffset:0,radius:["30%","60%"],center:["26%","50%"],minAngle:2,avoidLabelOverlap:!0,label:{normal:{show:!1,position:"center"},emphasis:{show:!0,textStyle:{fontSize:"18",fontWeight:"bold",color:""},formatter:""}},itemStyle:{normal:{}},labelLine:{normal:{show:!1}},data:[]},{radius:["40%","50%"],center:["26%","50%"],type:"pie",label:{normal:{show:!1},emphasis:{show:!1}},labelLine:{normal:{show:!1},emphasis:{show:!1}},tooltip:{show:!1},data:[{value:0,name:"",itemStyle:{normal:{color:"rgba(255,255,255,0.09)"}}}],animation:!1},{radius:["75%","85%"],center:["26%","50%"],type:"pie",label:{normal:{show:!1},emphasis:{show:!1}},labelLine:{normal:{show:!1},emphasis:{show:!1}},tooltip:{show:!1},data:[{value:0,name:"",itemStyle:{normal:{color:"rgba(255,255,255,0.09)"}}}],animation:!1}]},i=[],o=[];for(t in this.appEchartsFilterpieLegend.seriesData)this.appEchartsFilterpieLegend.seriesData.hasOwnProperty(t)&&(o.push({name:this.appEchartsFilterpieLegend.seriesData[t].name,value:this.appEchartsFilterpieLegend.seriesData[t].count}),i.push(this.appEchartsFilterpieLegend.seriesData[t].name));e.series[0].data=o,e.series[0].name=this.appEchartsFilterpieLegend.name,e.legend.data=i,e.legend.formatter=function(t){var e,i={};for(e in a.appEchartsFilterpieLegend.seriesData)a.appEchartsFilterpieLegend.seriesData.hasOwnProperty(e)&&(i[a.appEchartsFilterpieLegend.seriesData[e].name]=a.appEchartsFilterpieLegend.seriesData[e].code);return["{a|"+t+"}","{b|"+i[t]+"}"].join("  |")},this.appEchartsFilterpieLegend.formatter?e.tooltip.formatter=this.appEchartsFilterpieLegend.formatter:("format"===this.appEchartsFilterpieLegend.formatValue&&(e.tooltip.formatter=function(t){var e=t.value;return'<span style="display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color:'+t.color+'"></span>'+t.name+": "+e+" ("+t.percent+"%)"}),"flow"===this.appEchartsFilterpieLegend.formatValue&&(e.tooltip.formatter=function(t){var e=t.value;return'<span style="display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color:'+t.color+'"></span>'+t.name+": "+e+" ("+t.percent+"%)"})),this.appEchartsFilterpieLegend.color&&(e.color=this.appEchartsFilterpieLegend.color),this.appEchartsFilterpieLegend.radius&&(e.series[0].radius=this.appEchartsFilterpieLegend.radius),this.appEchartsFilterpieLegend.radius1&&(e.series[1].radius=this.appEchartsFilterpieLegend.radius1),this.appEchartsFilterpieLegend.radius2&&(e.series[2].radius=this.appEchartsFilterpieLegend.radius2),this.appEchartsFilterpieLegend.center&&(e.series[0].center=this.appEchartsFilterpieLegend.center),this.appEchartsFilterpieLegend.legendX&&(e.legend.x=this.appEchartsFilterpieLegend.legendX),!1===this.appEchartsFilterpieLegend.tooltip&&delete e.tooltip,this.appEchartsFilterpieLegend.type&&(e.legend.type=this.appEchartsFilterpieLegend.type),this.appEchartsFilterpieLegend.tooltip&&this.appEchartsFilterpieLegend.tooltip.position&&(e.tooltip.position=this.appEchartsFilterpieLegend.tooltip.position),this.chart.clear(),this.chart.setOption(e,!1)},s.prototype.initChart=function(){this.chart=l.init(this.el.nativeElement),this.backEmit.call(this.that,this.chart);var o,n,r,s,t=this.chart.resize,e=this.resizeNamespace;h(window).off(e),this.chart.off("click"),h(window).on(e,(o=t,void 0===(n=200)&&(n=200),void 0===(r=!1)&&(r=!0),function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this,a=r&&!s;clearTimeout(s),s=setTimeout(function(){s=null,r||o.apply(i,t)},n),a&&o.apply(i,t)}))},s.prototype.relieve=function(){var t=this.resizeNamespace;h(window).off(t),this.chart&&this.chart.dispose()},s.prototype.ngOnInit=function(){},s.prototype.ngOnChanges=function(t){t=t.appEchartsFilterpieLegend;t&&t.previousValue!==t.currentValue&&t.currentValue&&(this.relieve(),this.initChart(),this.renderChart())},s.prototype.ngOnDestroy=function(){this.relieve()},s.prototype.resize=function(t,e){this.chart&&this.chart.resize({width:e,height:t})},s.decorators=[{type:a.Directive,args:[{selector:"[appEchartsFilterpieLegend]"}]}],s.ctorParameters=function(){return[{type:a.ElementRef}]},s.propDecorators={appEchartsFilterpieLegend:[{type:a.Input}],backEmit:[{type:a.Input}],that:[{type:a.Input}]},c.decorators=[{type:a.NgModule,args:[{imports:[e.NgZorroAntdModule,i.CommonModule],declarations:[n,s],entryComponents:[n],exports:[n,s]}]}],t.createPlugin({name:"doughnut",component:n,module:c})});
//# sourceMappingURL=doughnut.umd.min.js.map